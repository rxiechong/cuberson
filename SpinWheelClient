-- [[ SPIN WHEEL CLIENT v1.0 - VISUALES ]]
-- UBICACIN: StarterPlayer -> StarterPlayerScripts -> LocalScript

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local pGui = player:WaitForChild("PlayerGui")

local Remotes = ReplicatedStorage:WaitForChild("ViralRemotes")
local spinFunc = Remotes:WaitForChild("SpinWheel")

-- === CREAR GUI ===
local sg = Instance.new("ScreenGui", pGui)
sg.Name = "SpinWheelGUI"
sg.ResetOnSpawn = false

-- Bot贸n para abrir/cerrar (Peque帽o a la izquierda)
local toggleBtn = Instance.new("TextButton", sg)
toggleBtn.Size = UDim2.new(0, 100, 0, 40)
toggleBtn.Position = UDim2.new(0, 10, 0.5, 0)
toggleBtn.Text = " RULETA"
toggleBtn.BackgroundColor3 = Color3.fromRGB(255, 170, 0)
toggleBtn.Font = Enum.Font.FredokaOne
toggleBtn.TextSize = 18
local corner = Instance.new("UICorner", toggleBtn); corner.CornerRadius = UDim.new(0,8)

-- Frame Principal (Centro)
local mainFrame = Instance.new("Frame", sg)
mainFrame.Size = UDim2.new(0, 300, 0, 350)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -175)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.Visible = false
local mfCorner = Instance.new("UICorner", mainFrame); mfCorner.CornerRadius = UDim.new(0,10)

-- La Rueda (Imagen)
local wheel = Instance.new("ImageLabel", mainFrame)
wheel.Size = UDim2.new(0, 250, 0, 250)
wheel.Position = UDim2.new(0.5, -125, 0, 20)
wheel.BackgroundTransparency = 1
-- Usamos una imagen de rueda gen茅rica de Roblox
wheel.Image = "rbxassetid://10470664057" 

-- Puntero (Flecha arriba)
local pointer = Instance.new("ImageLabel", mainFrame)
pointer.Size = UDim2.new(0, 40, 0, 40)
pointer.Position = UDim2.new(0.5, -20, 0, 10)
pointer.BackgroundTransparency = 1
pointer.Image = "rbxassetid://6813293883" -- Flecha blanca
pointer.Rotation = 180
pointer.ZIndex = 2

-- Bot贸n GIRAR
local spinBtn = Instance.new("TextButton", mainFrame)
spinBtn.Size = UDim2.new(0, 200, 0, 50)
spinBtn.Position = UDim2.new(0.5, -100, 1, -60)
spinBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
spinBtn.Text = "隆GIRAR!"
spinBtn.Font = Enum.Font.FredokaOne
spinBtn.TextSize = 24
spinBtn.TextColor3 = Color3.new(1,1,1)
local sbCorner = Instance.new("UICorner", spinBtn); sbCorner.CornerRadius = UDim.new(0,8)

-- Etiqueta de Resultado
local resultLabel = Instance.new("TextLabel", mainFrame)
resultLabel.Size = UDim2.new(1,0,0,30)
resultLabel.Position = UDim2.new(0,0,1,-90)
resultLabel.BackgroundTransparency = 1
resultLabel.Text = ""
resultLabel.TextColor3 = Color3.new(1,1,0)
resultLabel.Font = Enum.Font.Code
resultLabel.TextSize = 18

-- === LGICA DE GIRO ===
local isSpinning = false

toggleBtn.MouseButton1Click:Connect(function()
	mainFrame.Visible = not mainFrame.Visible
end)

spinBtn.MouseButton1Click:Connect(function()
	if isSpinning then return end
	isSpinning = true
	resultLabel.Text = "Girando..."
	spinBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
	
	-- Invocar servidor
	local success, resultData, prizeName = spinFunc:InvokeServer()
	
	if success then
		local targetAngle = resultData
		-- Calcular rotaci贸n total (5 vueltas completas + 谩ngulo objetivo)
		-- Ajustamos negativo para girar horario
		local endRotation = -(360 * 5 + targetAngle) 
		
		-- Resetear rotaci贸n actual (m贸dulo 360) para suavidad
		wheel.Rotation = wheel.Rotation % 360
		
		local tweenInfo = TweenInfo.new(4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
		local tween = TweenService:Create(wheel, tweenInfo, {Rotation = endRotation})
		
		tween:Play()
		tween.Completed:Wait()
		
		resultLabel.Text = "隆GANASTE: " .. string.upper(prizeName) .. "!"
		task.wait(1)
	else
		resultLabel.Text = resultData -- Mensaje de error (Cooldown)
	end
	
	isSpinning = false
	spinBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
end)
